Granting User Access to a Kubernetes Cluster (Manual CSR + Kubeconfig Method)
ğŸ“ Overview

This document describes how to securely create and grant access to a new Kubernetes user using client certificates, CSR signing, and RBAC permissions.
Weâ€™ll create a user harsh and provide them with a custom kubeconfig (harsh.kubeconfig) for cluster access.

ğŸ§° Prerequisites

Access to control plane (admin kubeconfig)

openssl and kubectl installed

Sudo privileges (if needed)

âš™ï¸ Step 1 â€” Create Private Key and CSR for the User
USER=harsh
openssl genrsa -out ${USER}.key 2048
openssl req -new -key ${USER}.key -out ${USER}.csr -subj "/CN=${USER}/O=dev"


CN â†’ Common Name (the username)

O â†’ Organization (optional, used for grouping via RBAC)

ğŸ§¾ Step 2 â€” Create Kubernetes CSR Manifest
cat <<EOF > ${USER}-csr.yaml
apiVersion: certificates.k8s.io/v1
kind: CertificateSigningRequest
metadata:
  name: ${USER}-csr
spec:
  request: $(cat ${USER}.csr | base64 | tr -d '\n')
  signerName: kubernetes.io/kube-apiserver-client
  usages:
  - client auth
EOF

ğŸš€ Step 3 â€” Submit and Approve the CSR
kubectl apply -f ${USER}-csr.yaml
kubectl get csr
kubectl certificate approve ${USER}-csr


Retrieve the signed certificate:

kubectl get csr ${USER}-csr -o jsonpath='{.status.certificate}' | base64 --decode > ${USER}.crt


You now have:

${USER}.key â†’ private key

${USER}.crt â†’ signed certificate

ğŸ”‘ Step 4 â€” Extract Cluster CA and API Server Info
kubectl config view --raw -o jsonpath='{.clusters[0].cluster.certificate-authority-data}' | base64 --decode > ca.crt
API_SERVER=$(kubectl config view --minify -o jsonpath='{.clusters[0].cluster.server}')
CLUSTER_NAME=$(kubectl config view --minify -o jsonpath='{.clusters[0].name}')

ğŸ§© Step 5 â€” Create Custom Kubeconfig for the User
cat <<EOF > ${USER}.kubeconfig
apiVersion: v1
kind: Config
clusters:
- name: ${CLUSTER_NAME}
  cluster:
    certificate-authority-data: $(base64 -w 0 ca.crt)
    server: ${API_SERVER}

users:
- name: ${USER}
  user:
    client-certificate-data: $(base64 -w 0 ${USER}.crt)
    client-key-data: $(base64 -w 0 ${USER}.key)

contexts:
- name: ${USER}-context
  context:
    cluster: ${CLUSTER_NAME}
    user: ${USER}
    namespace: default

current-context: ${USER}-context
EOF

ğŸ”’ Step 6 â€” Assign RBAC Permissions
Example: Cluster-admin access
kubectl create clusterrolebinding ${USER}-admin \
  --clusterrole=cluster-admin \
  --user=${USER}

Example: Read-only access
kubectl create rolebinding ${USER}-readonly \
  --clusterrole=view \
  --user=${USER} \
  --namespace=default

ğŸŒ Step 7 â€” Verify Access
KUBECONFIG=${USER}.kubeconfig kubectl get pods
KUBECONFIG=${USER}.kubeconfig kubectl auth can-i create pods

ğŸ’» Step 8 â€” Share Access with Remote User

Send only ${USER}.kubeconfig to the user (securely).

Ensure API server IP (https://<ip>:6443) is reachable from their machine.

They can test:

KUBECONFIG=harsh.kubeconfig kubectl get pods

ğŸ§  Notes
File	Description	Shareable
ca.crt	Cluster CA public cert	âœ… Yes
ca.key	CA private key	âŒ No
harsh.crt	Userâ€™s signed cert	âœ… Yes